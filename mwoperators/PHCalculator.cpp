#include "PHCalculator.h"

using namespace std;
using namespace Eigen;

PHCalculator::PHCalculator(const ScalingBasis &basis) {
    readSMatrix(basis);
}

void PHCalculator::readSMatrix(const ScalingBasis &basis) {
    if (basis.getScalingType() != Legendre) NOT_IMPLEMENTED_ABORT;

    int kp1 = basis.getQuadratureOrder();
    this->S_m1 = MatrixXd::Zero(kp1, kp1);
    this->S_0 = MatrixXd::Zero(kp1, kp1);
    this->S_p1 = MatrixXd::Zero(kp1, kp1);

    if (kp1 == 1) {
        this->S_p1 <<
-5.00000000000000000e-01;
        this->S_0  <<
 0.00000000000000000e+00;
        this->S_m1 <<
 5.00000000000000000e-01;
    }
    if (kp1 == 2) {
        this->S_p1 <<
-5.83333333333333333e-01,-8.66025403784438647e-01,
 1.04778382186265417e+00, 1.49074074074074074e+00;
        this->S_0  <<
 0.00000000000000000e+00, 1.15470053837925153e+00,
-2.09556764372530833e+00, 0.00000000000000000e+00;
        this->S_m1 <<
 5.83333333333333333e-01,-8.66025403784438647e-01,
 1.04778382186265417e+00,-1.49074074074074074e+00;
    }
    if (kp1 == 3) {
        this->S_p1 <<
-6.77083333333333333e-01,-9.18147303086279862e-01,-4.63518257835893906e-01,
 8.51992584741635243e-01, 1.14583333333333333e+00, 6.07394957651741884e-01,
-3.88206246093713489e-01,-3.58609569093279341e-01, 1.21527777777777778e-01;
        this->S_0 <<
 0.00000000000000000e+00, 6.09425284144604974e-01, 0.00000000000000000e+00,
-1.70398516948327049e+00, 0.00000000000000000e+00, 1.42099041753211939e+00,
 0.00000000000000000e+00,-1.97235263001303638e+00, 0.00000000000000000e+00;
        this->S_m1 <<
 6.77083333333333333e-01,-9.18147303086279862e-01, 4.63518257835893906e-01,
 8.51992584741635243e-01,-1.14583333333333333e+00, 6.07394957651741884e-01,
 3.88206246093713489e-01,-3.58609569093279341e-01,-1.21527777777777778e-01;
    }
    if (kp1 == 4) {
        this->S_p1 <<
-7.44875257201646091e-01,-1.14737228843467642e+00,-1.03594108670913734e+00,-3.93191565316273614e-01,
 1.05163653604324183e+00, 1.51317258230452675e+00, 1.12940431281057934e+00, 1.14957123269458620e-01,
-9.03430700307467115e-01,-1.31900085994429882e+00,-1.03460005144032922e+00,-2.16588167779423700e-01,
 2.68395281288477046e-01, 2.36136396549596226e-01,-1.67456693179587316e-01,-5.66314729080932785e-01;
        this->S_0 <<
 0.00000000000000000e+00, 5.98199028910362250e-01, 0.00000000000000000e+00, 8.24622932874133778e-03,
-2.10327307208648366e+00, 0.00000000000000000e+00, 7.10757525024933482e-01, 0.00000000000000000e+00,
 0.00000000000000000e+00,-3.62114977631166147e+00, 0.00000000000000000e+00, 3.49952552725295343e+00,
-5.36790562576954092e-01, 0.00000000000000000e+00,-3.20867841417530269e+00, 0.00000000000000000e+00;
        this->S_m1 <<
 7.44875257201646091e-01,-1.14737228843467642e+00, 1.03594108670913734e+00,-3.93191565316273614e-01,
 1.05163653604324183e+00,-1.51317258230452675e+00, 1.12940431281057934e+00,-1.14957123269458620e-01,
 9.03430700307467115e-01,-1.31900085994429882e+00, 1.03460005144032922e+00,-2.16588167779423700e-01,
 2.68395281288477046e-01,-2.36136396549596226e-01,-1.67456693179587316e-01, 5.66314729080932785e-01;
    }
    if (kp1 == 5) {
        this->S_p1 <<
-5.74199817101051669e-01,-8.21923495683338954e-01,-6.23986624588609572e-01,-1.05795959931947690e-01, 2.30916252188558278e-01,
 9.97919053242830006e-01, 1.45509902263374486e+00, 1.15802822562372360e+00, 2.93431674918006399e-01,-3.56801752558722314e-01,
-6.05647388379572668e-01,-7.22585632355441355e-01,-2.13685526079430400e-01, 4.90816104203108510e-01, 5.18207397128414160e-01,
 3.14400077411241962e-01, 3.21310128092337753e-01,-5.20106073426036694e-02,-4.79413151577503429e-01,-3.94477710334395065e-01,
 2.36897685457356239e-01, 5.04571475703301393e-01, 7.60994397672767934e-01, 7.52577614938236226e-01, 2.37582416797308773e-01;
        this->S_0 <<
 0.00000000000000000e+00, 1.12977557884131977e+00, 0.00000000000000000e+00,-7.76947819946532872e-01, 0.00000000000000000e+00,
-1.99583810648566001e+00, 0.00000000000000000e+00, 1.19522929902172043e+00, 0.00000000000000000e+00,-3.71317795375294160e-02,
 0.00000000000000000e+00,-2.75087692786839853e+00, 0.00000000000000000e+00, 1.51460764048536911e+00, 0.00000000000000000e+00,
-6.28800154822483925e-01, 0.00000000000000000e+00,-3.35450302771000618e+00, 0.00000000000000000e+00, 3.94109941083635540e+00,
 0.00000000000000000e+00, 6.32132358223844223e-01, 0.00000000000000000e+00,-2.16349664087318770e+00, 0.00000000000000000e+00;
        this->S_m1 <<
 5.74199817101051669e-01,-8.21923495683338954e-01, 6.23986624588609572e-01,-1.05795959931947690e-01,-2.30916252188558278e-01,
 9.97919053242830006e-01,-1.45509902263374486e+00, 1.15802822562372360e+00,-2.93431674918006399e-01,-3.56801752558722314e-01,
 6.05647388379572668e-01,-7.22585632355441355e-01, 2.13685526079430400e-01, 4.90816104203108510e-01,-5.18207397128414160e-01,
 3.14400077411241962e-01,-3.21310128092337753e-01,-5.20106073426036694e-02, 4.79413151577503429e-01,-3.94477710334395065e-01,
-2.36897685457356239e-01, 5.04571475703301393e-01,-7.60994397672767934e-01, 7.52577614938236226e-01,-2.37582416797308773e-01;
    }
    if (kp1 == 6) {
        this->S_p1 <<
-7.02591813237158289e-01,-1.07729800975920882e+00,-1.01767834333373372e+00,-5.71791306229490052e-01, 6.20926702248215349e-02, 4.08651763609458821e-01,
 7.42809824107415241e-01, 1.04582136606169603e+00, 7.70309034122221414e-01, 8.79191815830866093e-02,-5.42757932142238189e-01,-4.53010869224399061e-01,
-1.02932706518330686e+00,-1.50643008389472894e+00,-1.24442749382256761e+00,-4.02742057788055952e-01, 5.01887626804926627e-01, 6.44261520661324832e-01,
 2.12710756929592376e-01, 9.94986629044481997e-02,-4.40272638530085420e-01,-1.09434538144574769e+00,-1.18770116294657137e+00,-2.05805231124026947e-01,
-1.25401478359958953e-01,-4.72797008015446021e-02, 2.98578582362939177e-01, 7.14797943806055324e-01, 7.76140714656972614e-01, 1.63241350924487088e-01,
-4.31170085446367929e-01,-8.07943800350410714e-01,-1.10271108360351822e+00,-1.15225681625827348e+00,-7.06118308093480012e-01, 1.96878734983225353e-01;
        this->S_0 <<
 0.00000000000000000e+00, 7.50998764621364927e-01, 0.00000000000000000e+00,-7.02447625935111740e-01, 0.00000000000000000e+00, 3.31426343186741628e-01,
-1.48561964821483048e+00, 0.00000000000000000e+00, 2.47546442692363795e+00, 0.00000000000000000e+00,-2.60166283858516586e+00, 0.00000000000000000e+00,
 0.00000000000000000e+00,-4.11852693022353831e+00, 0.00000000000000000e+00, 1.42860108514065959e+00, 0.00000000000000000e+00, 2.42358346627506368e+00,
-4.25421513859184752e-01, 0.00000000000000000e+00,-3.28565660982453088e+00, 0.00000000000000000e+00, 1.66032269736950486e+00, 0.00000000000000000e+00,
 0.00000000000000000e+00,-7.74247525851702772e-01, 0.00000000000000000e+00,-4.62905040765071817e+00, 0.00000000000000000e+00, 7.06759074722988900e+00,
 8.62340170892735857e-01, 0.00000000000000000e+00, 1.25831808456201036e+00, 0.00000000000000000e+00,-3.84174972726371459e+00, 0.00000000000000000e+00;
        this->S_m1 <<
 7.02591813237158289e-01,-1.07729800975920882e+00, 1.01767834333373372e+00,-5.71791306229490052e-01,-6.20926702248215349e-02, 4.08651763609458821e-01,
 7.42809824107415241e-01,-1.04582136606169603e+00, 7.70309034122221414e-01,-8.79191815830866093e-02,-5.42757932142238189e-01, 4.53010869224399061e-01,
 1.02932706518330686e+00,-1.50643008389472894e+00, 1.24442749382256761e+00,-4.02742057788055952e-01,-5.01887626804926627e-01, 6.44261520661324832e-01,
 2.12710756929592376e-01,-9.94986629044481997e-02,-4.40272638530085420e-01, 1.09434538144574769e+00,-1.18770116294657137e+00, 2.05805231124026947e-01,
 1.25401478359958953e-01,-4.72797008015446021e-02,-2.98578582362939177e-01, 7.14797943806055324e-01,-7.76140714656972614e-01, 1.63241350924487088e-01,
-4.31170085446367929e-01, 8.07943800350410714e-01,-1.10271108360351822e+00, 1.15225681625827348e+00,-7.06118308093480012e-01,-1.96878734983225353e-01;
    }
    if (kp1 == 7) {
        this->S_p1 <<
-4.48198662623263246e-01,-6.67005059138748982e-01,-5.95894952573249463e-01,-3.07956795717217765e-01, 3.75847759829696440e-02, 1.64981598553390325e-01, 8.58348829028231854e-02,
 8.33732493132788201e-01, 1.22502582860776341e+00, 1.04060305826581495e+00, 4.14870940194373806e-01,-2.96221834264042633e-01,-4.91538204151944508e-01,-1.34454101901936403e-01,
-5.29900603353654377e-01,-6.97893684218567992e-01,-4.03382126889616846e-01, 1.53076675713524889e-01, 5.41136192743604854e-01, 3.02290683736968900e-01,-2.48067019921875916e-01,
 3.78047646891709807e-01, 4.00230873170853081e-01,-4.44382497231687306e-02,-7.05061005960470481e-01,-1.02778374720688859e+00,-5.00334906401783542e-01, 4.87430131344980871e-01,
 3.40500445075276465e-01, 7.21560614754215198e-01, 1.13888228433261523e+00, 1.35411983766581539e+00, 9.88451069357236303e-01, 9.45502578907540234e-03,-8.78886803557120566e-01,
-3.34422199149475823e-01,-6.46709810497002879e-01,-9.24505401754231975e-01,-1.02907576836832000e+00,-7.38891924980083429e-01,-5.19159926936436567e-02, 6.15183377346664317e-01,
 3.35220814471155567e-01, 5.58573109304552308e-01, 6.23753738773609111e-01, 4.88944546987259472e-01, 1.49319955982678272e-01,-2.16586457451443721e-01,-3.29225540222843327e-01;
        this->S_0 <<
 0.00000000000000000e+00, 1.69290031122359701e+00, 0.00000000000000000e+00, 7.61814567793696188e-01, 0.00000000000000000e+00,-2.53388101631062914e+00, 0.00000000000000000e+00,
-1.66746498626557640e+00, 0.00000000000000000e+00, 2.27138875102694803e+00, 0.00000000000000000e+00,-1.94758763011056678e+00, 0.00000000000000000e+00, 9.79463276261556191e-01,
 0.00000000000000000e+00,-2.27547170344259358e+00, 0.00000000000000000e+00, 4.25590602451321178e+00, 0.00000000000000000e+00,-3.70727677038426405e+00, 0.00000000000000000e+00,
-7.56095293783419613e-01, 0.00000000000000000e+00,-3.85485632104299764e+00, 0.00000000000000000e+00, 2.16647710192591513e+00, 0.00000000000000000e+00, 2.91171373463181533e+00,
 0.00000000000000000e+00, 9.15935053972348601e-01, 0.00000000000000000e+00,-2.25079060190734316e+00, 0.00000000000000000e+00, 1.05258416319227885e+00, 0.00000000000000000e+00,
 6.68844398298951645e-01, 0.00000000000000000e+00, 8.03714745771480795e-01, 0.00000000000000000e+00,-4.03599062679858106e+00, 0.00000000000000000e+00, 4.84488924062424652e+00,
 0.00000000000000000e+00, 1.20533171106554254e+00, 0.00000000000000000e+00, 1.61282736215259732e+00, 0.00000000000000000e+00,-3.69850102251838204e+00, 0.00000000000000000e+00;
        this->S_m1 <<
 4.48198662623263246e-01,-6.67005059138748982e-01, 5.95894952573249463e-01,-3.07956795717217765e-01,-3.75847759829696440e-02, 1.64981598553390325e-01,-8.58348829028231854e-02,
 8.33732493132788201e-01,-1.22502582860776341e+00, 1.04060305826581495e+00,-4.14870940194373806e-01,-2.96221834264042633e-01, 4.91538204151944508e-01,-1.34454101901936403e-01,
 5.29900603353654377e-01,-6.97893684218567992e-01, 4.03382126889616846e-01, 1.53076675713524889e-01,-5.41136192743604854e-01, 3.02290683736968900e-01, 2.48067019921875916e-01,
 3.78047646891709807e-01,-4.00230873170853081e-01,-4.44382497231687306e-02, 7.05061005960470481e-01,-1.02778374720688859e+00, 5.00334906401783542e-01, 4.87430131344980871e-01,
-3.40500445075276465e-01, 7.21560614754215198e-01,-1.13888228433261523e+00, 1.35411983766581539e+00,-9.88451069357236303e-01, 9.45502578907540234e-03, 8.78886803557120566e-01,
-3.34422199149475823e-01, 6.46709810497002879e-01,-9.24505401754231975e-01, 1.02907576836832000e+00,-7.38891924980083429e-01, 5.19159926936436567e-02, 6.15183377346664317e-01,
-3.35220814471155567e-01, 5.58573109304552308e-01,-6.23753738773609111e-01, 4.88944546987259472e-01,-1.49319955982678272e-01,-2.16586457451443721e-01, 3.29225540222843327e-01;
    }
    if (kp1 == 8) {
        this->S_p1 <<
-4.73029786964778530e-01,-7.06191411087451988e-01,-6.35374071851702045e-01,-3.28410320784732720e-01, 7.99151898133381080e-02, 3.43317284454759447e-01, 2.41705782921881454e-01,-4.56392091005481480e-02,
 4.88990297010897433e-01, 7.09732486561592442e-01, 6.00925740262485474e-01, 2.74318958057137321e-01,-8.49755600296280268e-02,-2.28103846771886538e-01,-3.99712893816196194e-02, 1.05698130370705783e-01,
-6.66092426936220516e-01,-9.21181581775955501e-01,-6.39416537339473105e-01, 2.72179289239422112e-02, 7.29156865159489918e-01, 9.16201921936300229e-01, 2.62167202898242790e-01,-6.35764350947389170e-01,
 6.34174579215049102e-02,-5.79253232386929776e-02,-4.22140758854281191e-01,-8.58925845875226455e-01,-1.01793245856056843e+00,-5.59150759613939613e-01, 3.97793433383013381e-01, 1.01607061070779948e+00,
 8.97607759428292266e-02, 3.60604828873897598e-01, 8.96229878489010344e-01, 1.51118638484089301e+00, 1.74983190443715295e+00, 1.12179052776608967e+00,-3.23492057724090883e-01,-1.63638612153607759e+00,
-7.44747932347643734e-01,-1.34902279950412365e+00,-1.78619279761364378e+00,-1.91309493189900361e+00,-1.44775675864935609e+00,-3.33850510712817962e-01, 9.18578505009722309e-01, 1.48083810176931488e+00,
 5.08764668911584785e-01, 9.19470541934899111e-01, 1.22086539161231642e+00, 1.33306298141343275e+00, 1.07527509894979398e+00, 3.80571251577530361e-01,-4.94373459496272676e-01,-1.06468653610199190e+00,
-3.80099608238428696e-01,-6.21581416065408747e-01,-6.80586116298872804e-01,-5.39594698848019324e-01,-1.96931699850952469e-01, 2.11825835994985423e-01, 4.16965391293069340e-01, 2.64882591005751317e-01;
        this->S_0 <<
 0.00000000000000000e+00, 1.59923793924674401e+00, 0.00000000000000000e+00, 5.69296510141670902e-01, 0.00000000000000000e+00,-2.84812604390312505e+00, 0.00000000000000000e+00, 1.80193164852079277e+00,
-9.77980594021794866e-01, 0.00000000000000000e+00, 4.41825708130142356e+00, 0.00000000000000000e+00, 1.29862104362031539e+00, 0.00000000000000000e+00,-7.82177966148712184e+00, 0.00000000000000000e+00,
 0.00000000000000000e+00,-2.77246054040966556e+00, 0.00000000000000000e+00, 3.53219713427144240e+00, 0.00000000000000000e+00,-4.15188693748029014e+00, 0.00000000000000000e+00, 4.88438051331071037e+00,
-1.26834915843009820e-01, 0.00000000000000000e+00,-1.75476269367260514e+00, 0.00000000000000000e+00, 6.38922762799811252e+00, 0.00000000000000000e+00,-8.26347036748211918e+00, 0.00000000000000000e+00,
 0.00000000000000000e+00,-9.93287599086495365e-02, 0.00000000000000000e+00,-4.41435500690353163e+00, 0.00000000000000000e+00, 1.68287931999785800e+00, 0.00000000000000000e+00, 6.33108215812670206e+00,
 1.48949586469528747e+00, 0.00000000000000000e+00, 2.65709828467392646e+00, 0.00000000000000000e+00,-2.45960928832230527e+00, 0.00000000000000000e+00,-2.07092146984501237e+00, 0.00000000000000000e+00,
 0.00000000000000000e+00, 1.68588393873349340e+00, 0.00000000000000000e+00, 1.18080587904413815e+00, 0.00000000000000000e+00,-6.31413384502669258e+00, 0.00000000000000000e+00, 7.01055655667884009e+00,
 7.60199216476857392e-01, 0.00000000000000000e+00, 1.93081708857032786e+00, 0.00000000000000000e+00, 1.98005084425952108e+00, 0.00000000000000000e+00,-6.69610687344813066e+00, 0.00000000000000000e+00;
        this->S_m1 <<
 4.73029786964778530e-01,-7.06191411087451988e-01, 6.35374071851702045e-01,-3.28410320784732720e-01,-7.99151898133381080e-02, 3.43317284454759447e-01,-2.41705782921881454e-01,-4.56392091005481480e-02,
 4.88990297010897433e-01,-7.09732486561592442e-01, 6.00925740262485474e-01,-2.74318958057137321e-01,-8.49755600296280268e-02, 2.28103846771886538e-01,-3.99712893816196194e-02,-1.05698130370705783e-01,
 6.66092426936220516e-01,-9.21181581775955501e-01, 6.39416537339473105e-01, 2.72179289239422112e-02,-7.29156865159489918e-01, 9.16201921936300229e-01,-2.62167202898242790e-01,-6.35764350947389170e-01,
 6.34174579215049102e-02, 5.79253232386929776e-02,-4.22140758854281191e-01, 8.58925845875226455e-01,-1.01793245856056843e+00, 5.59150759613939613e-01, 3.97793433383013381e-01,-1.01607061070779948e+00,
-8.97607759428292266e-02, 3.60604828873897598e-01,-8.96229878489010344e-01, 1.51118638484089301e+00,-1.74983190443715295e+00, 1.12179052776608967e+00, 3.23492057724090883e-01,-1.63638612153607759e+00,
-7.44747932347643734e-01, 1.34902279950412365e+00,-1.78619279761364378e+00, 1.91309493189900361e+00,-1.44775675864935609e+00, 3.33850510712817962e-01, 9.18578505009722309e-01,-1.48083810176931488e+00,
-5.08764668911584785e-01, 9.19470541934899111e-01,-1.22086539161231642e+00, 1.33306298141343275e+00,-1.07527509894979398e+00, 3.80571251577530361e-01, 4.94373459496272676e-01,-1.06468653610199190e+00,
-3.80099608238428696e-01, 6.21581416065408747e-01,-6.80586116298872804e-01, 5.39594698848019324e-01,-1.96931699850952469e-01,-2.11825835994985423e-01, 4.16965391293069340e-01,-2.64882591005751317e-01;
    }
    if (kp1 == 9) {
        this->S_p1 <<
-5.03548947428958740e-01,-8.14335731686848121e-01,-9.03885075155649880e-01,-8.16468328048416115e-01,-5.74785736079890507e-01,-2.41877743548029178e-01, 7.35226096760010572e-02, 3.57945491963720460e-01, 6.67642004378878139e-01,
 6.12438656722554490e-01, 9.19630732247009429e-01, 8.50766435260045489e-01, 5.05693074281777400e-01, 4.68670554373370901e-02,-2.62081604555761788e-01,-2.06300349152714376e-01, 6.38469164782643569e-03,-8.57164100075168996e-02,
-7.47166083435447565e-01,-1.17476206363576634e+00,-1.22834166474710142e+00,-1.00690171443120727e+00,-6.19211194849316862e-01,-2.34755216263444182e-01, 2.48594273000002483e-02, 3.31499053104572767e-01, 8.55016951602482619e-01,
 2.53695286347717270e-01, 2.61350709015654708e-01,-5.39411815828933025e-02,-5.43853322310918009e-01,-8.94865783432483680e-01,-7.34353612781819161e-01,-1.84368459729007761e-03, 7.04348740075896642e-01, 7.47540689874189530e-01,
-3.29220337660145107e-02, 3.26489860208300285e-02, 2.11517515154339302e-01, 3.81968962578042937e-01, 3.50590047647662028e-01, 1.32340583277040368e-02,-4.07361611717408717e-01,-4.08354125171025529e-01, 5.80849121039284642e-02,
-5.76793327923391891e-01,-1.07800440028035860e+00,-1.50214555907792494e+00,-1.72387717348634123e+00,-1.47297309897773527e+00,-6.22707531993683363e-01, 4.94683309325074401e-01, 1.18024927969179666e+00, 1.18003418728319881e+00,
 4.69080060969590728e-01, 7.69890175842443320e-01, 8.40284882351525755e-01, 6.38246243131183451e-01, 1.49493740186089879e-01,-4.27494596889650383e-01,-6.68936051886495873e-01,-3.04144546592965934e-01, 2.64753944542478256e-01,
-3.79452102111317417e-01,-6.27875924354571080e-01,-7.07948271053288627e-01,-6.02614358905148066e-01,-2.97087774866137173e-01, 1.06240037268349924e-01, 3.71912697704572303e-01, 3.22726076972948257e-01, 1.12563360213996453e-01,
 1.86638701909867762e-02,-7.67606012766117465e-03,-1.06715912163501316e-01,-2.65504442290049898e-01,-4.14361821385440559e-01,-4.24870272313150401e-01,-1.89880341788937092e-01, 2.26254579573417307e-01, 5.50506583668983296e-01;
        this->S_0 <<
 0.00000000000000000e+00, 1.60408363433230634e+00, 0.00000000000000000e+00, 1.55004436677941773e+00, 0.00000000000000000e+00,-1.17246860958652750e-01, 0.00000000000000000e+00,-4.72985476750996129e+00, 0.00000000000000000e+00,
-1.22487731344510898e+00, 0.00000000000000000e+00, 3.85783824274405647e+00, 0.00000000000000000e+00, 9.49109085937787700e-01, 0.00000000000000000e+00,-5.98535359985515962e+00, 0.00000000000000000e+00, 2.40212676153565992e+00,
 0.00000000000000000e+00,-2.82699434553823574e+00, 0.00000000000000000e+00, 5.46692706771065842e+00, 0.00000000000000000e+00, 1.44543422761947608e+00, 0.00000000000000000e+00,-8.94307050429675207e+00, 0.00000000000000000e+00,
-5.07390572695434540e-01, 0.00000000000000000e+00,-2.65064873282293022e+00, 0.00000000000000000e+00, 5.71416394872352786e+00, 0.00000000000000000e+00,-6.02003691411119155e+00, 0.00000000000000000e+00, 4.59646371728287741e+00,
 0.00000000000000000e+00,-2.93388512726601177e-01, 0.00000000000000000e+00,-2.58340355650325267e+00, 0.00000000000000000e+00, 7.65437387484746504e+00, 0.00000000000000000e+00,-8.67418736191053814e+00, 0.00000000000000000e+00,
 1.15358665584678378e+00, 0.00000000000000000e+00, 1.78090784291966083e+00, 0.00000000000000000e+00,-3.37974580517094170e+00, 0.00000000000000000e+00, 4.24847911690084372e-02, 0.00000000000000000e+00, 3.55795036790697893e+00,
 0.00000000000000000e+00, 1.71010164198246463e+00, 0.00000000000000000e+00, 2.65372117721718669e+00, 0.00000000000000000e+00,-2.21655595672687307e+00, 0.00000000000000000e+00,-3.51435852418187607e+00, 0.00000000000000000e+00,
 7.58904204222634833e-01, 0.00000000000000000e+00, 1.87065288238037720e+00, 0.00000000000000000e+00, 1.78581991820443775e+00, 0.00000000000000000e+00,-6.42903962495360736e+00, 0.00000000000000000e+00, 3.65141074378066366e+00,
 0.00000000000000000e+00, 1.44659206001959717e-01, 0.00000000000000000e+00, 8.81890211321870179e-01, 0.00000000000000000e+00, 1.87306329046909546e+00, 0.00000000000000000e+00,-5.17939412627391710e+00, 0.00000000000000000e+00;
        this->S_m1 <<
 5.03548947428958740e-01,-8.14335731686848121e-01, 9.03885075155649880e-01,-8.16468328048416115e-01, 5.74785736079890507e-01,-2.41877743548029178e-01,-7.35226096760010572e-02, 3.57945491963720460e-01,-6.67642004378878139e-01,
 6.12438656722554490e-01,-9.19630732247009429e-01, 8.50766435260045489e-01,-5.05693074281777400e-01, 4.68670554373370901e-02, 2.62081604555761788e-01,-2.06300349152714376e-01,-6.38469164782643569e-03,-8.57164100075168996e-02,
 7.47166083435447565e-01,-1.17476206363576634e+00, 1.22834166474710142e+00,-1.00690171443120727e+00, 6.19211194849316862e-01,-2.34755216263444182e-01,-2.48594273000002483e-02, 3.31499053104572767e-01,-8.55016951602482619e-01,
 2.53695286347717270e-01,-2.61350709015654708e-01,-5.39411815828933025e-02, 5.43853322310918009e-01,-8.94865783432483680e-01, 7.34353612781819161e-01,-1.84368459729007761e-03,-7.04348740075896642e-01, 7.47540689874189530e-01,
 3.29220337660145107e-02, 3.26489860208300285e-02,-2.11517515154339302e-01, 3.81968962578042937e-01,-3.50590047647662028e-01, 1.32340583277040368e-02, 4.07361611717408717e-01,-4.08354125171025529e-01,-5.80849121039284642e-02,
-5.76793327923391891e-01, 1.07800440028035860e+00,-1.50214555907792494e+00, 1.72387717348634123e+00,-1.47297309897773527e+00, 6.22707531993683363e-01, 4.94683309325074401e-01,-1.18024927969179666e+00, 1.18003418728319881e+00,
-4.69080060969590728e-01, 7.69890175842443320e-01,-8.40284882351525755e-01, 6.38246243131183451e-01,-1.49493740186089879e-01,-4.27494596889650383e-01, 6.68936051886495873e-01,-3.04144546592965934e-01,-2.64753944542478256e-01,
-3.79452102111317417e-01, 6.27875924354571080e-01,-7.07948271053288627e-01, 6.02614358905148066e-01,-2.97087774866137173e-01,-1.06240037268349924e-01, 3.71912697704572303e-01,-3.22726076972948257e-01, 1.12563360213996453e-01,
-1.86638701909867762e-02,-7.67606012766117465e-03, 1.06715912163501316e-01,-2.65504442290049898e-01, 4.14361821385440559e-01,-4.24870272313150401e-01, 1.89880341788937092e-01, 2.26254579573417307e-01,-5.50506583668983296e-01;
    }
    if (kp1 == 10) {
        this->S_p1 <<
-3.00389934329390869e-01,-4.59981701007445371e-01,-4.53814932431797091e-01,-3.34324766434868545e-01,-1.63772300008753944e-01,-2.09042625272516642e-02, 3.23671352864966388e-02, 1.44771059214264748e-02, 7.79021275733226134e-02, 3.14404196651023801e-01,
 8.65727307041553016e-01, 1.45116907682557747e+00, 1.74555114633048144e+00, 1.82307262575702892e+00, 1.65899693528428652e+00, 1.20348052953797203e+00, 4.48187719636069473e-01,-5.13829559804682762e-01,-1.51969617828953219e+00,-2.27096367285065569e+00,
-3.72658670839954922e-01,-5.19680951416555443e-01,-3.88618285902725437e-01,-8.34788468770879992e-02, 2.27466402649466618e-01, 3.35637498204949905e-01, 1.19715230088623295e-01,-2.62178102624332956e-01,-3.38305768296582484e-01, 9.38093009975161751e-02,
 6.96308460659807664e-01, 1.14692405335287792e+00, 1.34202102792928789e+00, 1.37330437167894224e+00, 1.27160764120873527e+00, 1.02845240298686572e+00, 5.83024855335838300e-01,-1.67023763802738764e-01,-1.23134016340857359e+00,-2.16308399805741735e+00,
 2.85379156406405049e-01, 6.13215021446459055e-01, 1.02428417328292869e+00, 1.41338183652315556e+00, 1.51507339703501645e+00, 1.05860754221378251e+00, 4.26878101136392099e-02,-1.02642185103194107e+00,-1.39305340565457329e+00,-9.91064024472789183e-01,
-1.30650888105178909e-01,-2.32362462651672003e-01,-2.74790538098421278e-01,-1.86182403982625145e-01, 1.09406089675823380e-01, 5.58070072574937593e-01, 8.61649397156041586e-01, 5.78433879101036586e-01,-3.80484110654836323e-01,-1.25399651678220535e+00,
 9.15137988564555457e-01, 1.60178605492250721e+00, 2.03556707273418147e+00, 2.15847172779474459e+00, 1.77779826955651983e+00, 8.19482636955704639e-01,-4.31810044548656492e-01,-1.33229355144645070e+00,-1.40286803253470418e+00,-1.02018415410461942e+00,
-3.73900577972398281e-01,-5.63489920779866655e-01,-4.93102763257424465e-01,-1.52851332286706088e-01, 4.06725472610645313e-01, 9.48380597718979003e-01, 1.05472705458601599e+00, 4.11091523656380212e-01,-7.19279703380824246e-01,-1.43135798963249050e+00,
 3.83927455268634376e-01, 6.23080818309952573e-01, 6.79551816668714121e-01, 5.52819905055082577e-01, 2.42478669605526148e-01,-1.60267201584543820e-01,-4.47246567831668287e-01,-4.07827521801332667e-01,-6.94987122672666372e-02, 2.05622579319623149e-01,
 8.02969628442341048e-02, 1.80565400359258006e-01, 3.28956207155229433e-01, 5.17404012393140296e-01, 6.74811036621218718e-01, 6.74573186299931517e-01, 3.96399425181984953e-01,-1.47036811037732038e-01,-7.19476471312157522e-01,-9.87611457991123807e-01;
        this->S_0 <<
 0.00000000000000000e+00, 2.30290250378951144e+00, 0.00000000000000000e+00, 2.40963927647423866e+00, 0.00000000000000000e+00,-4.00063713412976223e-01, 0.00000000000000000e+00,-6.72008436184708669e+00, 0.00000000000000000e+00, 3.39075058233581064e+00,
-1.73145461408310603e+00, 0.00000000000000000e+00, 3.50637776578754435e+00, 0.00000000000000000e+00, 3.53754371109516646e+00, 0.00000000000000000e+00, 3.65867503316468758e-01, 0.00000000000000000e+00,-1.51005742434503186e+01, 0.00000000000000000e+00,
 0.00000000000000000e+00,-1.54249310427044250e+00, 0.00000000000000000e+00, 7.04994071753278815e+00, 0.00000000000000000e+00, 9.47107086202702822e-01, 0.00000000000000000e+00,-1.32009894555307426e+01, 0.00000000000000000e+00, 8.13585316361010336e+00,
-1.39261692131961533e+00, 0.00000000000000000e+00,-3.59988763997977951e+00, 0.00000000000000000e+00, 8.92133927890534341e+00, 0.00000000000000000e+00, 3.13794186552640273e+00, 0.00000000000000000e+00,-1.93982409238154701e+01, 0.00000000000000000e+00,
 0.00000000000000000e+00, 7.50734750375237122e-01, 0.00000000000000000e+00,-1.56800097810037393e+00, 0.00000000000000000e+00, 7.21499614202959563e+00, 0.00000000000000000e+00,-1.27407922247979603e+01, 0.00000000000000000e+00, 1.00170251179264568e+01,
 2.61301776210357818e-01, 0.00000000000000000e+00, 4.55568489148953114e-01, 0.00000000000000000e+00,-1.48398216045306518e+00, 0.00000000000000000e+00, 1.01023456126347247e+01, 0.00000000000000000e+00,-1.86240843777810050e+01, 0.00000000000000000e+00,
 0.00000000000000000e+00, 3.13668985867577068e+00, 0.00000000000000000e+00, 3.58125994703883805e+00, 0.00000000000000000e+00,-4.43007626974979374e+00, 0.00000000000000000e+00,-4.69505124217805071e+00, 0.00000000000000000e+00, 6.24973140737515173e+00,
 7.47801155944796562e-01, 0.00000000000000000e+00, 2.28946252084312460e+00, 0.00000000000000000e+00, 3.86932455904310951e+00, 0.00000000000000000e+00,-2.82053109739806639e+00, 0.00000000000000000e+00,-9.48754234231682518e+00, 0.00000000000000000e+00,
 0.00000000000000000e+00, 1.41376579916370359e+00, 0.00000000000000000e+00, 2.56335996468171190e+00, 0.00000000000000000e+00, 1.79782158333065034e+00, 0.00000000000000000e+00,-1.01299157293156451e+01, 0.00000000000000000e+00, 5.90626149291986973e+00,
-1.60593925688468210e-01, 0.00000000000000000e+00,-1.51988680175226972e-02, 0.00000000000000000e+00, 1.25188376498101142e+00, 0.00000000000000000e+00, 2.53116425174871718e+00, 0.00000000000000000e+00,-8.07829085908721508e+00, 0.00000000000000000e+00;
        this->S_m1 <<
 3.00389934329390869e-01,-4.59981701007445371e-01, 4.53814932431797091e-01,-3.34324766434868545e-01, 1.63772300008753944e-01,-2.09042625272516642e-02,-3.23671352864966388e-02, 1.44771059214264748e-02,-7.79021275733226134e-02, 3.14404196651023801e-01,
 8.65727307041553016e-01,-1.45116907682557747e+00, 1.74555114633048144e+00,-1.82307262575702892e+00, 1.65899693528428652e+00,-1.20348052953797203e+00, 4.48187719636069473e-01, 5.13829559804682762e-01,-1.51969617828953219e+00, 2.27096367285065569e+00,
 3.72658670839954922e-01,-5.19680951416555443e-01, 3.88618285902725437e-01,-8.34788468770879992e-02,-2.27466402649466618e-01, 3.35637498204949905e-01,-1.19715230088623295e-01,-2.62178102624332956e-01, 3.38305768296582484e-01, 9.38093009975161751e-02,
 6.96308460659807664e-01,-1.14692405335287792e+00, 1.34202102792928789e+00,-1.37330437167894224e+00, 1.27160764120873527e+00,-1.02845240298686572e+00, 5.83024855335838300e-01, 1.67023763802738764e-01,-1.23134016340857359e+00, 2.16308399805741735e+00,
-2.85379156406405049e-01, 6.13215021446459055e-01,-1.02428417328292869e+00, 1.41338183652315556e+00,-1.51507339703501645e+00, 1.05860754221378251e+00,-4.26878101136392099e-02,-1.02642185103194107e+00, 1.39305340565457329e+00,-9.91064024472789183e-01,
-1.30650888105178909e-01, 2.32362462651672003e-01,-2.74790538098421278e-01, 1.86182403982625145e-01, 1.09406089675823380e-01,-5.58070072574937593e-01, 8.61649397156041586e-01,-5.78433879101036586e-01,-3.80484110654836323e-01, 1.25399651678220535e+00,
-9.15137988564555457e-01, 1.60178605492250721e+00,-2.03556707273418147e+00, 2.15847172779474459e+00,-1.77779826955651983e+00, 8.19482636955704639e-01, 4.31810044548656492e-01,-1.33229355144645070e+00, 1.40286803253470418e+00,-1.02018415410461942e+00,
-3.73900577972398281e-01, 5.63489920779866655e-01,-4.93102763257424465e-01, 1.52851332286706088e-01, 4.06725472610645313e-01,-9.48380597718979003e-01, 1.05472705458601599e+00,-4.11091523656380212e-01,-7.19279703380824246e-01, 1.43135798963249050e+00,
-3.83927455268634376e-01, 6.23080818309952573e-01,-6.79551816668714121e-01, 5.52819905055082577e-01,-2.42478669605526148e-01,-1.60267201584543820e-01, 4.47246567831668287e-01,-4.07827521801332667e-01, 6.94987122672666372e-02, 2.05622579319623149e-01,
 8.02969628442341048e-02,-1.80565400359258006e-01, 3.28956207155229433e-01,-5.17404012393140296e-01, 6.74811036621218718e-01,-6.74573186299931517e-01, 3.96399425181984953e-01, 1.47036811037732038e-01,-7.19476471312157522e-01, 9.87611457991123807e-01;
    }
    if (kp1 >= 11) {
        NOT_IMPLEMENTED_ABORT;
    }
}

void PHCalculator::calcNode(MWNode<2> &node) {
    node.zeroCoefs();
    int kp1 = node.getKp1();
    int kp1_d = node.getKp1_d();
    int l = node.getTranslation()[1] - node.getTranslation()[0];
    double two_np1 = pow(2.0, node.getScale() + 1);
    double *coefs = node.getCoefs();

    switch (l) {
    case 1:
        for (int i = 0; i < kp1; i++) {
            for (int j = 0; j < kp1; j++) {
                int idx = i*kp1 + j;
                coefs[1*kp1_d+idx] = two_np1*this->S_p1(i,j);
            }
        }
        break;
    case 0:
        for (int i = 0; i < kp1; i++) {
            for (int j = 0; j < kp1; j++) {
                int idx = i*kp1 + j;
                coefs[0*kp1_d+idx] = two_np1*this->S_0(i,j);
                coefs[1*kp1_d+idx] = two_np1*this->S_m1(i,j);
                coefs[2*kp1_d+idx] = two_np1*this->S_p1(i,j);
                coefs[3*kp1_d+idx] = two_np1*this->S_0(i,j);
            }
        }
        break;
    case -1:
        for (int i = 0; i < kp1; i++) {
            for (int j = 0; j < kp1; j++) {
                int idx = i*kp1 + j;
                coefs[2*kp1_d+idx] = two_np1*this->S_m1(i,j);
            }
        }
        break;
    default:
        MSG_ERROR("This translation should not occour");
        break;
    }
    node.mwTransform(Compression);
    node.setHasCoefs();
    node.calcNorms();
}
